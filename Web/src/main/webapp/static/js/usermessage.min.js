let spage=1;let apage=1;let fpage=1;let sendPage=1;let MID;let now=0;function getMPages(a,b){let pageList=$("#pageList");pageList.empty();let s="";if(b!==1){s+=HTML.a("javascript:toPage("+a+","+(b-1)+")",'<span class="glyphicon glyphicon-chevron-left"></span>上一页')}s+="&nbsp;&nbsp;&nbsp;&nbsp;";s+=HTML.a("javascript:toPage("+a+","+(b+1)+")",'下一页<span class="glyphicon glyphicon-chevron-right"></span>');pageList.append(HTML.span(s))}function toPage(a,b){if(a===0){spage=b;loadSystemMessage()}else{if(a===1){apage=b;loadAboutMessage()}else{if(a===2){fpage=b;loadFriendMessage()}else{if(a===3){sendPage=b;loadSendMessage()}}}}}function loadSystemMessage(){now=0;$("#messageInfo h3").text("系统消息");$.getJSON("/api/message/system/"+spage,function(a){let tbody=$("#messageInfo table tbody");tbody.empty();for(let i=0;i<a.length;i++){let state="";if(a[i].status===0){state=HTML.bS("color: red;","未读")}else{state=HTML.bS("color: blue;","已读")}tbody.append(HTML.tr(HTML.td(a[i].mid)+HTML.td(HTML.a("javascript:showMessage("+a[i].mid+",0)",a[i].title))+HTML.td("管理员")+HTML.td(a[i].date)+HTML.td(state)))}getMPages(0,spage)})}function loadAboutMessage(){now=1;$("#messageInfo h3").text("提到我的");$.getJSON("/api/message/about/"+apage,function(a){let tbody=$("#messageInfo table tbody");tbody.empty();for(let i=0;i<a.length;i++){let state="";if(a[i].status===0){state=HTML.bS("color: red;","未读")}else{state=HTML.bS("color: blue;","已读")}tbody.append(HTML.tr(HTML.td(a[i].mid)+HTML.td(HTML.a("javascript:showMessage("+a[i].mid+",1)",a[i].title))+HTML.td("-")+HTML.td(a[i].date)+HTML.td(state)))}getMPages(1,apage)})}function loadFriendMessage(){now=2;$("#messageInfo h3").text("好友留言");$.getJSON("/api/message/friend/"+fpage,function(a){let tbody=$("#messageInfo table tbody");tbody.empty();for(let i=0;i<a.length;i++){let state="";if(a[i].status===0){state=HTML.bS("color: red;","未读")}else{state=HTML.bS("color: blue;","已读")}tbody.append(HTML.tr(HTML.td(a[i].mid)+HTML.td(HTML.a("javascript:showMessage("+a[i].mid+",2)",a[i].title))+HTML.td(getStyleName(a[i].username))+HTML.td(a[i].date)+HTML.td(state)))}getMPages(2,fpage)})}function loadSendMessage(){$("#messageInfo h3").text("我发送的");$.getJSON("/api/message/send/"+sendPage,function(a){let tbody=$("#messageInfo table tbody");tbody.empty();for(let i=0;i<a.length;i++){let state="";if(a[i].status===0){state=HTML.bS("color: red;","未读")}else{state=HTML.bS("color: blue;","已读")}tbody.append(HTML.tr(HTML.td(a[i].mid)+HTML.td(HTML.a("javascript:showMessage("+a[i].mid+",3)",a[i].title))+HTML.td(getStyleName(a[i].username))+HTML.td(a[i].date)+HTML.td(state)))}getMPages(3,sendPage)})}function newMsg(){$.ajax({url:"/api/message/send",type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({name:$("#newMsg input[name='name']").val(),title:$("#newMsg input[name='title']").val(),text:$("#newMsg textarea").val()}),success:function(a){if(a.state===0){narn("success","发送成功");$("#newMsg input[name='name']").val("");$("#newMsg input[name='title']").val("");$("#newMsg textarea").val("")}else{narn("log","没有这个用户")}}})}function showMessage(b,a){if(a===0){$("#editor").hide();$("#replyBtn").hide()}else{if(a===1){$("#editor").hide();$("#replyBtn").hide()}else{if(a===2){$("#replyBtn").show();$("#editor").show();MID=b}else{if(a===3){$("#editor").hide();$("#replyBtn").hide()}}}}$.getJSON("/api/message/content/"+b,function(c){$("#showMsgBtn").click();$("#msgContent").html(c.content)});if(a!==3){$.ajax({url:"/api/message/status/"+b,type:"PUT",dataType:"json",contentType:"application/json",success:function(c){if(a===0){loadSystemMessage()}else{if(a===1){loadAboutMessage()}else{if(a===2){loadFriendMessage()}}}}})}}function replyMsg(){$.ajax({url:"/api/message/reply/"+MID,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({content:$("#editor").val()}),success:function(a){if(a.state===0){narn("success","回复成功");$("#editor").val("")}else{narn("log","回复失败")}}})}function changeAllState(){if(now<=2){$.ajax({url:"/api/message/status/all/"+now,type:"POST",contentType:"application/json",dataType:"json",success:function(a){if(a.state===0){narn("success","全部设为已读成功");if(now===0){loadSystemMessage()}else{if(now===1){loadAboutMessage()}else{if(now===2){loadFriendMessage()}}}}else{narn("log","失败")}}})}}loadSystemMessage();