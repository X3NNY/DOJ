let hash;let bid;$.getJSON("/api/index/blog",function(a){bid=a.bid;loadNotice()});function hashInfo(){hash=location.hash;switch(hash){case"#slogout":narn("log","注销成功！");break;case"#slogin":getGreetingMsg();break;case"#sregister":narn("success","激活成功");break}}function getGreetingMsg(){$.getJSON("/api/user/curuser",function(a){if(a.state!==0){return""}let username=a.username;let info="";let time=new Date().getHours();if(time<6){info="凌晨好，"+username+"，新的一天开始了。"}else{if(time<11){info="上午好，"+username}else{if(time<14){info="中午好，"+username}else{if(time<19){info="下午好，"+username}else{if(time<24){info="晚上好，"+username}}}}}narn("success",info)})}function loadNotify(){$.getJSON("/api/about/notify",function(a){if(a.msg&&a.msg.length!==0){$("#Notify").show();$("#Notify span").html(a.msg)}})}function loadNotice(){$.getJSON("/api/blog/info/"+bid,function(a){$("#Notice .panel-heading font").text(a.title);$("#Notice .panel-body").html(a.text);$("#Notice .panel-heading front").append(HTML.frontSR("Written by "+getStyleName(a.username)+" at "+a.date+" "+HTML.a("blog.jsp?bid="+bid,'<span class="glyphicon glyphicon-arrow-right" style="color: #fff;"></span>')));let footer=$("#Notice .panel-footer");footer.append(HTML.frontSL(getVote(bid,a.up_vote,a.down_vote,a.my_vote)));footer.append(HTML.frontSR(a.num+" replies."));footer.append("<br />");hLight()})}function loadContests(){$.getJSON("/api/contest?page=1",function(a){let Contests=$("#Contests table tbody");for(let i=0;i<Math.min(5,a.contests.length);i++){let tp=a.contests[i];let c="";if(new Date().getTime()<new Date(tp.starttime).getTime()){c=HTML.a("contestR.jsp?cid="+tp.cid,"[报名]")}else{if(new Date().getTime()<new Date(tp.endstime).getTime()){c="[进行中]"}else{c="[已结束]"}}c+='<span class="glyphicon glyphicon-user" style="color: rgb(42, 39, 156);"></span>x'+tp.num;Contests.append(HTML.tr(HTML.td(tp.cid)+HTML.td(tp.title)+HTML.td(tp.starttime)+HTML.td(c)))}})}function loadProblems(){$.getJSON("/api/problem/toindex",function(a){let Problems=$("#Problems table tbody");for(let i=0;i<a.length;i++){let tp=a[i];let ra=((tp.ac_cnt/tp.all_cnt)*100).toFixed(2);if(tp.all_cnt===0){ra="0.00%(0/0)"}else{ra=ra+"%("+tp.ac_cnt+"/"+tp.all_cnt+")"}let ts=HTML.td(tp.pid)+HTML.tdC(HTML.a("/problem.jsp?pid="+tp.pid,tp.title))+HTML.tdC(ra)+HTML.tdC(getStyleName(tp.author));if(tp.state===0){Problems.append(HTML.tr(ts))}else{if(tp.state===1){Problems.append(HTML.trClass("success",ts))}else{Problems.append(HTML.trClass("danger",ts))}}}})}function loadTop10(){$.getJSON("/api/rank/toindex",function(a){let Top=$("#Top10 table tbody");for(let i=0;i<a.rankset.length;i++){let tp=a.rankset[i];Top.append(HTML.tr(HTML.td(i+1)+HTML.td(getStyleName(tp.username)+HTML.tdR(tp.rating))))}})}function loadBlogs(){$.getJSON("/api/blog/toindex",function(a){let Blogs=$("#Blogs table tbody");let tot=0;for(let i=0;i<a.blogset.length;i++){let tp=a.blogset[i];Blogs.append(HTML.tr(HTML.td(tp.bid)+HTML.tdC(HTML.a("/blog.jsp?bid="+tp.bid,tp.title))+HTML.tdR(getStyleName(tp.author))));tot++}})}function loadThing(){$.getJSON("/api/user/edit",function(a){if(a.note!=null){$("#Thing div.panel-body").text(removeHtml(a.note))}else{$.getJSON("/api/about/index_thing",function(b){$("#Thing div.panel-body").text(b.msg)})}})}function search(){let name=$("#Search input").val();$.ajax({url:"/api/user/search?name="+name,type:"POST",contentType:"application/json",dataType:"json",success:function(a){if(a.state===1){location.href="userinfo.jsp?uid="+a.uid}else{narn("log","该用户不存在")}}})}function addStar(a){$.ajax({url:"/api/blog/upvote?bid="+a,type:"POST",contentType:"application/json",dataType:"json",success:function(b){if(b.state===0){narn("success","点赞成功");loadNotice()}else{narn("log","您现在不能投票")}}})}function subStar(a){$.ajax({url:"/api/blog/downvote?bid="+a,type:"POST",contentType:"application/json",dataType:"json",success:function(b){if(b.state===0){narn("success","点踩成功");loadNotice()}else{narn("log","您现在不能投票")}}})}function hLight(){$("pre code").each(function(a,b){hljs.highlightBlock(b)});$("code").each(function(){$(this).html("<ol><li>"+$(this).html().replace(/\n/g,"\n</li><li>")+"\n</li></ol>")})}function processData(a){let time=new Date(new Date().getTime()-30*86400000).getTime();time=time-time%(86400000);let res=[];let j=0;for(let i=0;i<30;i++){if(typeof a[j]=="undefined"||a[j][0]-a[j][0]%(86400000)!==time){res.push([time,0])}else{res.push([time,a[j][1]]);j++}time+=86400000}return res}function loadPicMessage(){let chart=null;$.getJSON("/api/visual/index/submit",function(a){chart=Highcharts.chart("picMessage",{title:{text:"30天内提交记录统计"},xAxis:{type:"datetime",tickmarkPlacement:"on",dateTimeLabelFormats:{day:"%m-%e"},title:{enabled:false}},yAxis:[{allowDecimals:false,title:{text:"提交数"},min:0,labels:{formatter:function(){return this.value}}}],legend:{align:"left",verticalAlign:"top",y:20,floating:true,borderWidth:0},tooltip:{shared:true,valueSuffix:"",formatter:function(){return"<b>开始时间：</b>"+Highcharts.dateFormat("%Y-%b-%e %H:%M:%S",this.x)+"<br><b>结束时间：</b>"+Highcharts.dateFormat("%Y-%b-%e %H:%M:%S",this.x+86400000)+"<br><b>总提交数:</b>"+this.points[0].y+"<br><b>总通过数:</b>"+this.points[1].y}},series:[{name:"submit",data:processData(a.submit)},{name:"ac",data:processData(a.ac)}]})})}loadNotify();loadBlogs();loadContests();loadProblems();loadTop10();loadThing();hashInfo();loadPicMessage();